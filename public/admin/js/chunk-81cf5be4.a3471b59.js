(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-81cf5be4","chunk-2d0b2396","chunk-2d224cde"],{"034a":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("d2-container",{class:{"page-compact":e.crud.pageOptions.compact}},[r("template",{slot:"header"}),r("d2-crud-x",e._g(e._b({ref:"d2Crud",scopedSlots:e._u([{key:"discount_valueSlot",fn:function(t){return[r("div",[e._v("订单满"+e._s(t.row["min_order_price"])+"元")]),0==t.row["type"]?r("div",[e._v("减 "+e._s(t.row["value"])+"元")]):e._e(),1==t.row["type"]?r("div",[e._v(e._s(t.row["value"])+"折")]):e._e()]}}])},"d2-crud-x",e._crudProps,!1),e._crudListeners),[r("div",{attrs:{slot:"header"},slot:"header"},[r("crud-search",{ref:"search",attrs:{options:e.crud.searchOptions},on:{submit:e.handleSearch}}),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"marketing:coupon:add",expression:"'marketing:coupon:add'"}],attrs:{slot:"header",size:"small",type:"primary"},on:{click:e.addRow},slot:"header"},[r("i",{staticClass:"el-icon-plus"}),e._v(" 新增")]),r("crud-toolbar",{attrs:{search:e.crud.searchOptions.show,compact:e.crud.pageOptions.compact,columns:e.crud.columns},on:{"update:search":function(t){return e.$set(e.crud.searchOptions,"show",t)},"update:compact":function(t){return e.$set(e.crud.pageOptions,"compact",t)},refresh:function(t){return e.doRefresh()},"columns-filter-changed":e.handleColumnsFilterChanged}})],1)])],2)},a=[],i=r("e261"),n=r("1fbf"),s=r("22ce"),d=r("22cc"),l={name:"Coupon",mixins:[n["d2CrudPlus"].crud],data:function(){return{}},methods:{getCrudOptions:function(){return Object(i["crudOptions"])(this)},pageRequest:function(e){return d["GetList"](e)},addRequest:function(e){return d["AddObj"](e)},updateRequest:function(e){return d["UpdateObj"](e)},delRequest:function(e){return d["DelObj"](e.id)},infoRequest:function(e){return d["GetObj"](e.id)},doDialogOpened:function(e){var t=this;Object(s["b"])({url:"/marketing.coupon/goodsListForCoupon",method:"post",data:{is_shelves:1}}).then((function(e){t.getD2Crud().getFormTemplate("goods_ids").component.data=e.data,t.getD2Crud().getFormTemplate("goods_ids").component.props.data=e.data,t.getD2Crud().getFormTemplate("goods_ids").component.titles=["可选","已选"]})),"edit"==e.mode&&(1==e.row.expire_type&&(e.row.expire_time=[new Date(e.row.start_time),new Date(e.row.end_time)],e.form.expire_time=[new Date(e.row.start_time),new Date(e.row.end_time)]),1==e.row.type&&(e.row.value_rate=e.row.value,e.form.value_rate=e.row.value),0==e.row.type&&(e.row.value_rate=e.row.value,e.form.value_price=e.row.value),1==e.row.apply_range&&(e.row.category_ids=e.row.apply_range_config,e.form.category_ids=e.row.apply_range_config),2==e.row.apply_range&&(e.row.goods_ids=e.row.apply_range_config,e.form.goods_ids=e.row.apply_range_config))},doCellDataChange:function(e){"is_user_receive"==e.key&&this.enableStatusUpdata(e,"marketing.coupon","setIsUserReceive"),"is_reg_send"==e.key&&this.enableStatusUpdata(e,"marketing.coupon","setIsRegSend"),"is_enable"==e.key&&this.enableStatusUpdata(e,"marketing.coupon","setIsEnable")},enableStatusUpdata:function(e,t,r){var o=this;if(e["value"]["value"])var a={params:1,id:e["row"]["id"]};else a={params:0,id:e["row"]["id"]};Object(s["b"])({url:"/"+t+"/"+r,method:"post",data:a}).then((function(e){200!==e.code&&o.$message.error(e.msg)}))}}},u=l,c=r("2877"),m=Object(c["a"])(u,o,a,!1,null,null,null);t["default"]=m.exports},"22cc":function(e,t,r){"use strict";r.r(t),r.d(t,"GetList",(function(){return i})),r.d(t,"AddObj",(function(){return n})),r.d(t,"UpdateObj",(function(){return s})),r.d(t,"DelObj",(function(){return d}));var o=r("22ce"),a="/marketing.coupon";function i(e){return Object(o["b"])({url:a+"/list",method:"post",data:e})}function n(e){return Object(o["b"])({url:a+"/add",method:"post",data:e})}function s(e){return Object(o["b"])({url:a+"/edit",method:"post",data:e})}function d(e){return Object(o["b"])({url:a+"/del",method:"post",data:{id:e}})}},e261:function(e,t,r){"use strict";r.r(t),r.d(t,"crudOptions",(function(){return i}));var o=r("ade3"),a=r("22ce"),i=function(e){var t;return{options:{height:"100%",highlightCurrentRow:!0,rowKey:"id"},formOptions:{labelWidth:"120px"},rowHandle:{view:{thin:!0,text:null,disabled:function(){return!e.hasPermissions("marketing:coupon:view")}},edit:{thin:!0,text:null,disabled:function(){return!e.hasPermissions("marketing:coupon:edit")}},remove:{thin:!0,text:null,disabled:function(){return!e.hasPermissions("marketing:coupon:del")}},width:180,fixed:"right"},columns:[{title:"Id",key:"id",sortable:!0,search:{disabled:!0},form:{disabled:!0},width:60},{title:"名称",key:"name",sortable:!1,search:{disabled:!1},width:150,form:{rules:[{required:!0,message:"请输入正确的名称"}]}},{title:"描述",key:"desc",show:!1,sortable:!0,search:{disabled:!0},form:{disabled:!1},width:200},{title:"订单最低金额",key:"min_order_price",show:!1,sortable:!0,search:{disabled:!0},form:{rules:[{required:!0,message:"请填写订单最低金额"}],component:{disabled:function(e){return e.form.receive_qty>0},show:function(e){return!(e.form.receive_qty>0)}}},width:200},{title:"到期类型",key:"expire_type",sortable:!0,type:"select",dict:{data:[{value:0,label:"领取生效"},{value:1,label:"固定日期"}]},search:{},form:{rules:[{required:!0,message:"请输入正确的到期类型"}],component:{disabled:function(e){return e.form.receive_qty>0||0!=e.form.receive_qty&&void 0!=e.form.receive_qty&&void 0},show:function(e){return!(e.form.receive_qty>0)&&(0==e.form.receive_qty||void 0==e.form.receive_qty||void 0)}}},width:200},{title:"有效小时",key:"expire_hour",type:"number",sortable:!0,search:{disabled:!0},show:!1,form:{rules:[{required:!0,message:"请输入有效小时"}],component:{disabled:function(e){return 0!=e.form.expire_type||0!=e.form.receive_qty&&void 0!=e.form.receive_qty},show:function(e){return 0==e.form.expire_type&&(0==e.form.receive_qty||void 0==e.form.receive_qty)}}},width:200},{title:"有效时间",key:"expire_time",sortable:!0,search:{disabled:!0},type:"daterange",show:!1,form:{rules:[{required:!0,message:"请选择有效时间"}],component:{disabled:function(e){return 1!=e.form.expire_type||0!=e.form.receive_qty&&void 0!=e.form.receive_qty},show:function(e){return 1==e.form.expire_type&&(0==e.form.receive_qty||void 0==e.form.receive_qty)}}},width:200},{title:"类型",key:"type",sortable:!0,type:"select",dict:{data:[{value:0,label:"满减劵"},{value:1,label:"折扣劵"}]},search:{disabled:!1},form:{rules:[{required:!0,message:"请输入正确的名称"}],component:{disabled:function(e){return e.form.receive_qty>0},show:function(e){return!(e.form.receive_qty>0)}}},width:200},{title:"减免金额",key:"value_price",sortable:!0,show:!1,search:{disabled:!0},form:{rules:[{required:!0,message:"请输入减免金额"}],component:{disabled:function(e){if(0==e.form.type)return!1},show:function(e){return 0==e.form.type}}},width:200},{title:"折扣率",key:"value_rate",sortable:!0,show:!1,search:{disabled:!0},form:{rules:[{required:!0,message:"请输入折扣率"}],component:{disabled:function(e){return 1!=e.form.type||0!=e.form.receive_qty&&void 0!=e.form.receive_qty},show:function(e){return 1==e.form.type&&(0==e.form.receive_qty||void 0==e.form.receive_qty)}}},width:200},{title:"使用限制",key:"apply_range",sortable:!0,type:"select",dict:{data:[{value:0,label:"全场适用"},{value:1,label:"限定商品分类"},{value:2,label:"限定商品可用"}]},search:{},form:{rules:[{required:!0,message:"请选择使用限制"}],component:{disabled:function(e){return e.form.receive_qty>0},show:function(e){return!(e.form.receive_qty>0)}}},width:200},{title:"分类指定",key:"category_ids",type:"tree-selector",dict:(t={url:"/goods.category/tree",isTree:!0,value:"id"},Object(o["a"])(t,"value","id"),Object(o["a"])(t,"label","name"),Object(o["a"])(t,"getData",(function(e,t){return Object(a["b"])({url:e,method:"post",data:{is_enable:1}}).then((function(e){return e.data}))})),t),sortable:!1,search:{disabled:!0},form:{rules:[{required:!0,message:"请选择分类"}],component:{disabled:function(e){return 1!=e.form.apply_range},show:function(e){return 1==e.form.apply_range},props:{ignoreFullCheckedChildren:!1,leafOnly:!0,includeHalfChecked:!1}},disabled:!1},show:!1},{title:"关联商品",key:"goods_ids",type:"transfer",show:!1,form:{rules:[{required:!0,message:"请选择关联商品"}],component:{disabled:function(e){return 2!=e.form.apply_range},show:function(e){return 2==e.form.apply_range},span:24,filterable:!0,titles:["可选","已选"],data:[]}},valueBuilder:function(e,t){""===e[t.key]&&(e[t.key]=null)}},{title:"优惠信息",key:"discount_value",rowSlot:!0,width:200,search:{disabled:!0},form:{disabled:!0},sortable:!1},{title:"领取数量",key:"receive_qty",search:{disabled:!0},sortable:!0,form:{disabled:!0,component:{readOnly:!0}}},{title:"发放数量",key:"total_qty",type:"number",search:{disabled:!0},sortable:!0,form:{disabled:!1,rules:[{required:!0,message:"请输入发放数量"},{type:"number",message:"请输入正确的发放数量"}],component:{value:0}}},{title:"开放领取",key:"is_user_receive",type:"switch",width:80,search:{disabled:!0},dict:{data:[{value:!1,label:"否"},{value:!0,label:"是"}]},form:{component:{value:!1}},sortable:!1},{title:"注册发放",key:"is_reg_send",type:"switch",width:80,search:{disabled:!0},dict:{data:[{value:!1,label:"否"},{value:!0,label:"是"}]},form:{component:{value:!1}},sortable:!1},{title:"启用",key:"is_enable",type:"switch",dict:{data:[{value:!0,label:"是",color:"success"},{value:!1,label:"否",color:"danger"}]},search:{disabled:!0},form:{component:{value:!1}},width:80},{title:"排序",key:"sort",width:200,search:{disabled:!0},form:{disabled:!1,component:{value:0}},show:!1,sortable:!0},{title:"创建时间",key:"create_time",show:!1,disabled:!0,search:{disabled:!0},form:{disabled:!0}}]}}}}]);
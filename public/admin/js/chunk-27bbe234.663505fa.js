(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27bbe234","chunk-2d219f9b","chunk-2d22bd7e","chunk-2d0c2186"],{"499d":function(e,t,n){"use strict";n.r(t),n.d(t,"crudOptions",(function(){return r}));var r=function(e){return{options:{defaultSort:{prop:"id",order:"descending"},height:"100%"},rowHandle:{width:180,view:{thin:!0,text:null,disabled:function(){return!e.hasPermissions("auth.role:view")}},edit:{thin:!0,text:null,disabled:function(){return!e.hasPermissions("auth.role:edit")}},remove:{thin:!0,text:null,disabled:function(){return!e.hasPermissions("auth.role:del")}},custom:[{thin:!0,text:null,type:"warning",size:"small",emit:"authz",icon:"el-icon-s-flag",disabled:function(){return!e.hasPermissions("auth.role:authz")}}]},columns:[{title:"创建时间",key:"createTime",sortable:"create_time",type:"datetime",form:{disabled:!0},show:!1},{title:"更新时间",key:"updateTime",sortable:"update_time",type:"datetime",form:{disabled:!0},show:!1},{title:"角色名称",key:"name",sortable:"name"},{title:"角色代码",key:"code",search:{disabled:!1},form:{editTemplateHandle:function(e){e.component.disabled=!0}}},{title:"状态",key:"is_enable",type:"select",dict:{data:[{value:!0,label:"启用"},{value:!1,label:"禁用",color:"danger"}]},search:{disabled:!1},form:{}}]}}},"9e04":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("d2-container",{class:{"page-compact":e.crud.pageOptions.compact}},[n("template",{slot:"header"}),n("d2-crud-x",e._g(e._b({ref:"d2Crud",attrs:{size:"mini"},on:{authz:e.authzHandle}},"d2-crud-x",e._crudProps,!1),e._crudListeners),[n("div",{staticClass:"d2-mb-5",attrs:{slot:"header"},slot:"header"}),n("div",{attrs:{slot:"header"},slot:"header"},[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"permission:role:add",expression:"'permission:role:add'"}],attrs:{size:"small",type:"primary"},on:{click:e.addRow}},[n("i",{staticClass:"el-icon-plus"}),e._v(" 新增")]),n("crud-toolbar",{attrs:{search:e.crud.searchOptions.show,compact:e.crud.pageOptions.compact,columns:e.crud.columns},on:{"update:search":function(t){return e.$set(e.crud.searchOptions,"show",t)},"update:compact":function(t){return e.$set(e.crud.pageOptions,"compact",t)},refresh:function(t){return e.doRefresh()},"columns-filter-changed":e.handleColumnsFilterChanged}})],1)]),n("el-dialog",{attrs:{title:"分配权限",visible:e.dialogPermissionVisible},on:{"update:visible":function(t){e.dialogPermissionVisible=t}}},[n("el-tree",{ref:"menuTree",staticClass:"filter-tree",attrs:{data:e.treeData,"default-checked-keys":e.checkedKeys,"check-strictly":!1,"node-key":"id","highlight-current":"",props:{label:"title",value:"id"},"show-checkbox":"","default-expand-all":""}}),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updatePermession(e.roleId)}}},[e._v("更 新 ")])],1)],1)],2)},i=[],o=(n("99af"),n("c975"),n("499d")),s=n("1fbf"),d=n("f163"),a=n("ba17"),u={name:"Role",mixins:[s["d2CrudPlus"].crud],data:function(){return{dsScopeData:[],treeData:[],checkedKeys:[],checkedDsScope:[],menuIds:"",list:[],listLoading:!0,form:{},roleId:void 0,rolesOptions:void 0,dialogPermissionVisible:!1}},methods:{getCrudOptions:function(){return Object(o["crudOptions"])(this)},pageRequest:function(e){return d["GetList"](e)},addRequest:function(e){return d["AddObj"](e)},updateRequest:function(e){return d["UpdateObj"](e)},delRequest:function(e){return d["DelObj"](e.id)},getAllCheckedLeafNodeId:function(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];i.children&&0!==i.children.length?this.getAllCheckedLeafNodeId(i.children,t,n):-1!==t.indexOf(i.id)&&n.push(i.id)}return n},authzHandle:function(e){var t=this;console.log("authz",e),a["GetTree"]().then((function(n){return t.$set(t,"treeData",n.data),t.$set(t,"checkedKeys",[]),t.roleId=e.row.id,t.updateChecked(e.row.id)})).then((function(){t.dialogPermissionVisible=!0}))},updateChecked:function(e){var t=this;return d["GetPermission"](e).then((function(e){var n=e.data;n=t.getAllCheckedLeafNodeId(t.treeData,n,[]),console.log("all leaf ",n),t.$set(t,"checkedKeys",n)}))},updatePermession:function(e){var t=this;this.menuIds=this.$refs.menuTree.getCheckedKeys().concat(this.$refs.menuTree.getHalfCheckedKeys()),d["DoAuthz"](e,this.menuIds).then((function(n){t.dialogPermissionVisible=!1,t.updateChecked(e),200==n.code&&t.$message({message:"操作成功！",type:"success"})}))}}},c=u,l=n("2877"),h=Object(l["a"])(c,r,i,!1,null,null,null);t["default"]=h.exports},ba17:function(e,t,n){"use strict";n.r(t),n.d(t,"GetList",(function(){return o})),n.d(t,"GetTree",(function(){return s})),n.d(t,"AddObj",(function(){return d})),n.d(t,"UpdateObj",(function(){return a})),n.d(t,"DelObj",(function(){return u})),n.d(t,"GetObj",(function(){return c}));var r=n("22ce"),i="/auth.menu";function o(e){return Object(r["b"])({url:i+"/list",method:"post",params:e})}function s(e){return Object(r["b"])({url:i+"/tree",method:"post",params:e})}function d(e){return Object(r["b"])({url:i+"/add",method:"post",data:e})}function a(e){return Object(r["b"])({url:i+"/edit",method:"post",data:e})}function u(e){return Object(r["b"])({url:i+"/del",method:"post",params:{id:e}})}function c(e){return Object(r["b"])({url:i+"/info",method:"get",params:{id:e}})}},f163:function(e,t,n){"use strict";n.r(t),n.d(t,"GetList",(function(){return o})),n.d(t,"AddObj",(function(){return s})),n.d(t,"UpdateObj",(function(){return d})),n.d(t,"DelObj",(function(){return a})),n.d(t,"GetPermission",(function(){return u})),n.d(t,"DoAuthz",(function(){return c}));var r=n("22ce"),i="/auth.role";function o(e){return Object(r["b"])({url:i+"/list",method:"post",data:e})}function s(e){return Object(r["b"])({url:i+"/add",method:"post",data:e})}function d(e){return Object(r["b"])({url:i+"/edit",method:"post",data:e})}function a(e){return Object(r["b"])({url:i+"/del",method:"post",data:{id:e}})}function u(e){return Object(r["b"])({url:i+"/getPermission",method:"post",data:{roleId:e}})}function c(e,t){return Object(r["b"])({url:i+"/authz",method:"post",data:{menu_ids:t,roleId:e}})}}}]);